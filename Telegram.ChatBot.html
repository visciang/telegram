<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.37.3">
    <meta name="project" content="telegram v2.1.0">


    <title>Telegram.ChatBot â€” telegram v2.1.0</title>

    <link rel="stylesheet" href="dist/html-elixir-6X3L5KMG.css" />

    <script defer src="dist/sidebar_items-FD56A45C.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-ALU6OERS.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="api-reference.html" class="sidebar-projectName" translate="no">
telegram
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v2.1.0
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-behaviour" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of telegram</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">Telegram.ChatBot</span> <small>behaviour</small>
      <small class="app-vsn" translate="no">(telegram v2.1.0)</small>

    </h1>

      <a href="https://github.com/visciang/telegram/blob/main/lib/chat_bot.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>Telegram Chat Bot behaviour.</p><p>The <a href="Telegram.ChatBot.html"><code class="inline">Telegram.ChatBot</code></a> module provides a stateful chatbot mechanism that manages bot instances
on a per-chat basis (<code class="inline">chat_id</code>). Unlike the <a href="Telegram.Bot.html"><code class="inline">Telegram.Bot</code></a> behavior, which is stateless,
each conversation in <a href="Telegram.ChatBot.html"><code class="inline">Telegram.ChatBot</code></a> is tied to a unique <code class="inline">chat_state</code>.</p><p>The <a href="#c:get_chat/2"><code class="inline">get_chat/2</code></a> callback is responsible for routing each incoming update to the correct
chat session by returning the chat's identifier. If the chat is not yet recognized,
a new bot instance will automatically be created for that chat.</p><p>Since each conversation is handled by a long-running process, it's crucial to manage session
timeouts carefully. Without implementing timeouts, your bot may hit the <code class="inline">max_bot_concurrency</code> limit,
preventing it from handling new conversations. To prevent this, you can utilize the underlying
<code class="inline">:gen_server</code> timeout mechanism by specifying timeouts in the return values of the <a href="#c:init/1"><code class="inline">init/1</code></a> or
<a href="#c:handle_update/3"><code class="inline">handle_update/3</code></a> callbacks. Alternatively, for more complex scenarios, you can manage explicit
timers in your bot's logic.</p><h2 id="module-example" class="section-heading">
  <a href="#module-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloBot</span><span class="w"> </span><span class="k" data-group-id="1156790582-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Telegram.ChatBot</span><span class="w">

  </span><span class="c1"># Session timeout set to 60 seconds</span><span class="w">
  </span><span class="na">@session_ttl</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1_000</span><span class="w">

  </span><span class="na">@impl</span><span class="w"> </span><span class="nc">Telegram.ChatBot</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">init</span><span class="p" data-group-id="1156790582-2">(</span><span class="c">_chat</span><span class="p" data-group-id="1156790582-2">)</span><span class="w"> </span><span class="k" data-group-id="1156790582-3">do</span><span class="w">
    </span><span class="c1"># Initialize state with a message counter set to 0</span><span class="w">
    </span><span class="n">count_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="p" data-group-id="1156790582-4">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">count_state</span><span class="p">,</span><span class="w"> </span><span class="na">@session_ttl</span><span class="p" data-group-id="1156790582-4">}</span><span class="w">
  </span><span class="k" data-group-id="1156790582-3">end</span><span class="w">

  </span><span class="na">@impl</span><span class="w"> </span><span class="nc">Telegram.ChatBot</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_update</span><span class="p" data-group-id="1156790582-5">(</span><span class="p" data-group-id="1156790582-6">%{</span><span class="s">&quot;message&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="1156790582-7">%{</span><span class="s">&quot;chat&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="1156790582-8">%{</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">chat_id</span><span class="p" data-group-id="1156790582-8">}</span><span class="p" data-group-id="1156790582-7">}</span><span class="p" data-group-id="1156790582-6">}</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="n">count_state</span><span class="p" data-group-id="1156790582-5">)</span><span class="w"> </span><span class="k" data-group-id="1156790582-9">do</span><span class="w">
    </span><span class="c1"># Increment the message count</span><span class="w">
    </span><span class="n">count_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count_state</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">

    </span><span class="nc">Telegram.Api</span><span class="o">.</span><span class="n">request</span><span class="p" data-group-id="1156790582-10">(</span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sendMessage&quot;</span><span class="p">,</span><span class="w">
      </span><span class="ss">chat_id</span><span class="p">:</span><span class="w"> </span><span class="n">chat_id</span><span class="p">,</span><span class="w">
      </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Hey! You sent me </span><span class="si" data-group-id="1156790582-11">#{</span><span class="n">count_state</span><span class="si" data-group-id="1156790582-11">}</span><span class="s"> messages&quot;</span><span class="w">
    </span><span class="p" data-group-id="1156790582-10">)</span><span class="w">

    </span><span class="p" data-group-id="1156790582-12">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">count_state</span><span class="p">,</span><span class="w"> </span><span class="na">@session_ttl</span><span class="p" data-group-id="1156790582-12">}</span><span class="w">
  </span><span class="k" data-group-id="1156790582-9">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_update</span><span class="p" data-group-id="1156790582-13">(</span><span class="n">update</span><span class="p">,</span><span class="w"> </span><span class="c">_token</span><span class="p">,</span><span class="w"> </span><span class="n">count_state</span><span class="p" data-group-id="1156790582-13">)</span><span class="w"> </span><span class="k" data-group-id="1156790582-14">do</span><span class="w">
    </span><span class="c1"># Ignore unknown updates and maintain the current state</span><span class="w">

    </span><span class="p" data-group-id="1156790582-15">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">count_state</span><span class="p">,</span><span class="w"> </span><span class="na">@session_ttl</span><span class="p" data-group-id="1156790582-15">}</span><span class="w">
  </span><span class="k" data-group-id="1156790582-14">end</span><span class="w">

  </span><span class="na">@impl</span><span class="w"> </span><span class="nc">Telegram.ChatBot</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_info</span><span class="p" data-group-id="1156790582-16">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="c">_token</span><span class="p">,</span><span class="w"> </span><span class="c">_chat_id</span><span class="p">,</span><span class="w"> </span><span class="n">count_state</span><span class="p" data-group-id="1156790582-16">)</span><span class="w"> </span><span class="k" data-group-id="1156790582-17">do</span><span class="w">
    </span><span class="c1"># Handle direct erlang messages, if needed</span><span class="w">

    </span><span class="p" data-group-id="1156790582-18">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">count_state</span><span class="p" data-group-id="1156790582-18">}</span><span class="w">
  </span><span class="k" data-group-id="1156790582-17">end</span><span class="w">

  </span><span class="na">@impl</span><span class="w"> </span><span class="nc">Telegram.ChatBot</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_timeout</span><span class="p" data-group-id="1156790582-19">(</span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="n">chat_id</span><span class="p">,</span><span class="w"> </span><span class="n">count_state</span><span class="p" data-group-id="1156790582-19">)</span><span class="w"> </span><span class="k" data-group-id="1156790582-20">do</span><span class="w">
    </span><span class="c1"># Send a &quot;goodbye&quot; message upon session timeout</span><span class="w">
    </span><span class="nc">Telegram.Api</span><span class="o">.</span><span class="n">request</span><span class="p" data-group-id="1156790582-21">(</span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sendMessage&quot;</span><span class="p">,</span><span class="w">
      </span><span class="ss">chat_id</span><span class="p">:</span><span class="w"> </span><span class="n">chat_id</span><span class="p">,</span><span class="w">
      </span><span class="ss">text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;See you!&quot;</span><span class="w">
    </span><span class="p" data-group-id="1156790582-21">)</span><span class="w">

    </span><span class="p" data-group-id="1156790582-22">{</span><span class="ss">:stop</span><span class="p">,</span><span class="w"> </span><span class="n">count_state</span><span class="p" data-group-id="1156790582-22">}</span><span class="w">
  </span><span class="k" data-group-id="1156790582-20">end</span><span class="w">
</span><span class="k" data-group-id="1156790582-1">end</span></code></pre>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:chat/0" data-no-tooltip="" translate="no">chat()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:chat_state/0" data-no-tooltip="" translate="no">chat_state()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:t/0" data-no-tooltip="" translate="no">t()</a>

      </div>

    </div>

</div>
<div class="summary-callbacks summary">
  <h2>
    <a href="#callbacks">Callbacks</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:get_chat/2" data-no-tooltip="" translate="no">get_chat(update_type, update)</a>

      </div>

        <div class="summary-synopsis"><p>Allows a chatbot to customize how incoming updates are processed.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:handle_info/4" data-no-tooltip="" translate="no">handle_info(msg, token, chat_id, chat_state)</a>

      </div>

        <div class="summary-synopsis"><p>Invoked to handle arbitrary erlang messages (e.g., scheduled events or direct messages).</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:handle_resume/1" data-no-tooltip="" translate="no">handle_resume(chat_state)</a>

      </div>

        <div class="summary-synopsis"><p>Invoked when a chat session is resumed.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:handle_timeout/3" data-no-tooltip="" translate="no">handle_timeout(token, chat_id, chat_state)</a>

      </div>

        <div class="summary-synopsis"><p>Callback invoked when a session times out.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:handle_update/3" data-no-tooltip="" translate="no">handle_update(update, token, chat_state)</a>

      </div>

        <div class="summary-synopsis"><p>Handles incoming Telegram update events and processes them based on the current <code class="inline">chat_state</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:init/1" data-no-tooltip="" translate="no">init(chat)</a>

      </div>

        <div class="summary-synopsis"><p>Invoked when a chat session is first initialized. Returns the initial <code class="inline">chat_state</code> for the session.</p></div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#lookup/2" data-no-tooltip="" translate="no">lookup(token, chat_id)</a>

      </div>

        <div class="summary-synopsis"><p>Retrieves the process ID (<code class="inline">pid</code>) of a specific chat session.</p></div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Types</span>
    </h1>
    <div class="types-list">
<section class="detail" id="t:chat/0">

  <div class="detail-header">
    <a href="#t:chat/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">chat()</h1>


        <a href="https://github.com/visciang/telegram/blob/main/lib/chat_bot.ex#L83" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> chat() :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:chat_state/0">

  <div class="detail-header">
    <a href="#t:chat_state/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">chat_state()</h1>


        <a href="https://github.com/visciang/telegram/blob/main/lib/chat_bot.ex#L84" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> chat_state() :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:t/0">

  <div class="detail-header">
    <a href="#t:t/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">t()</h1>


        <a href="https://github.com/visciang/telegram/blob/main/lib/chat_bot.ex#L81" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> t() :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">module</a>()</pre>

      </div>


  </section>
</section>

    </div>
  </section>

  <section id="callbacks" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#callbacks">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Callbacks</span>
    </h1>
    <div class="callbacks-list">
<section class="detail" id="c:get_chat/2">

  <div class="detail-header">
    <a href="#c:get_chat/2" class="detail-link" data-no-tooltip="" aria-label="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_chat(update_type, update)</h1>

        <span class="note">(optional)</span>


        <a href="https://github.com/visciang/telegram/blob/main/lib/chat_bot.ex#L228" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@callback</span> get_chat(update_type :: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(), update :: <a href="Telegram.Types.html#t:update/0">Telegram.Types.update</a>()) ::
  {:ok, <a href="Telegram.ChatBot.Chat.html#t:t/0">Telegram.ChatBot.Chat.t</a>()} | :ignore</pre>

      </div>

<p>Allows a chatbot to customize how incoming updates are processed.</p><p>This function receives an update and either returns the unique chat identifier
associated with it or instructs the bot to ignore the update.</p><h3 id="c:get_chat/2-parameters" class="section-heading">
  <a href="#c:get_chat/2-parameters" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Parameters:</span>
</h3>
<ul><li><code class="inline">update_type</code>: is a string representing the type of update received. For example:<ul><li><code class="inline">message</code>: For new messages.</li><li><code class="inline">edited_message</code>: For edited messages.</li><li><code class="inline">inline_query</code>: For inline queries.</li></ul></li><li><code class="inline">update</code>: the update object received, containing the data associated with the <code class="inline">update_type</code>.
The object structure depends on the type of update:<ul><li>For <code class="inline">message</code> and <code class="inline">edited_message</code> updates, the object is of type <a href="https://core.telegram.org/bots/api#message"><code class="inline">Message</code></a>,
which contains fields such as text, sender, and chat.</li><li>For <code class="inline">inline_query</code> updates, the object is of type <a href="https://core.telegram.org/bots/api#inlinequery"><code class="inline">InlineQuery</code></a>, containing fields like query and from.</li></ul></li></ul><p>Refer to the official Telegram Bot API <a href="https://core.telegram.org/bots/api#update">documentation</a>
for a complete list of update types.</p><h3 id="c:get_chat/2-return-values" class="section-heading">
  <a href="#c:get_chat/2-return-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Return values:</span>
</h3>
<ul><li>Returning <code class="inline">{:ok, %Telegram.ChatBot.Chat{id: id, metadata: %{}}}</code> will trigger
the bot to spin up a new instance, which will manage the update as a full chat session.
The instance will be uniquely identified by the return <code class="inline">id</code> and
<a href="#c:init/1"><code class="inline">init/1</code></a> will be called with the returned <a href="Telegram.ChatBot.Chat.html#t:t/0"><code class="inline">Telegram.ChatBot.Chat.t/0</code></a> struct.</li><li>Returning <code class="inline">:ignore</code> will cause the update to be disregarded entirely.</li></ul><p>This callback is <strong>optional</strong>.
If not implemented, the bot will dispatch updates of type <a href="https://core.telegram.org/bots/api#message"><code class="inline">Message</code></a>.</p>
  </section>
</section>
<section class="detail" id="c:handle_info/4">

  <div class="detail-header">
    <a href="#c:handle_info/4" class="detail-link" data-no-tooltip="" aria-label="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">handle_info(msg, token, chat_id, chat_state)</h1>

        <span class="note">(optional)</span>


        <a href="https://github.com/visciang/telegram/blob/main/lib/chat_bot.ex#L191" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@callback</span> handle_info(
  msg :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>(),
  token :: <a href="Telegram.Types.html#t:token/0">Telegram.Types.token</a>(),
  chat_id :: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(),
  chat_state :: <a href="#t:chat_state/0">chat_state</a>()
) ::
  {:ok, next_chat_state :: <a href="#t:chat_state/0">chat_state</a>()}
  | {:ok, next_chat_state :: <a href="#t:chat_state/0">chat_state</a>(), timeout :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">timeout</a>()}
  | {:stop, next_chat_state :: <a href="#t:chat_state/0">chat_state</a>()}</pre>

      </div>

<p>Invoked to handle arbitrary erlang messages (e.g., scheduled events or direct messages).</p><p>This callback can be used for:</p><ul><li>Scheduled Events: handle messages triggered by Process.send/3 or Process.send_after/4.</li><li>Direct Interactions: respond to direct messages sent to a specific chat session retrieved via <a href="#lookup/2"><code class="inline">lookup/2</code></a>.</li></ul><h3 id="c:handle_info/4-parameters" class="section-heading">
  <a href="#c:handle_info/4-parameters" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Parameters:</span>
</h3>
<ul><li><code class="inline">msg</code>: the message received.</li><li><code class="inline">token</code>: the bot's authentication token, used to make API requests.</li><li><code class="inline">chat_id</code>: the ID of the chat session associated with the message.</li><li><code class="inline">chat_state</code>: the current state of the chat session.</li></ul><h3 id="c:handle_info/4-return-values" class="section-heading">
  <a href="#c:handle_info/4-return-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Return values:</span>
</h3>
<ul><li><code class="inline">{:ok, next_chat_state}</code>: updates the session with a new <code class="inline">next_chat_state</code>.</li><li><code class="inline">{:ok, next_chat_state, timeout}</code>: updates the <code class="inline">next_chat_state</code> and sets a new <code class="inline">timeout</code>.</li><li><code class="inline">{:stop, next_chat_state}</code>: terminates the session and returns the final <code class="inline">chat_state</code>.</li></ul><p>This callback is <strong>optional</strong>.
If not implemented, any received message will be logged by default.</p>
  </section>
</section>
<section class="detail" id="c:handle_resume/1">

  <div class="detail-header">
    <a href="#c:handle_resume/1" class="detail-link" data-no-tooltip="" aria-label="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">handle_resume(chat_state)</h1>

        <span class="note">(optional)</span>


        <a href="https://github.com/visciang/telegram/blob/main/lib/chat_bot.ex#L119" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@callback</span> handle_resume(chat_state :: <a href="#t:chat_state/0">chat_state</a>()) ::
  {:ok, next_chat_state :: <a href="#t:chat_state/0">chat_state</a>()}
  | {:ok, next_chat_state :: <a href="#t:chat_state/0">chat_state</a>(), timeout :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">timeout</a>()}</pre>

      </div>

<p>Invoked when a chat session is resumed.</p><p>If implemented, this function allows custom logic when resuming a session, for example,
updating the state or setting a new timeout.</p><p>Note: you can manually resume a session by calling <code class="inline">MyChatBot.resume(token, chat_id, state)</code>.</p><h3 id="c:handle_resume/1-return-values" class="section-heading">
  <a href="#c:handle_resume/1-return-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Return values</span>
</h3>
<ul><li><code class="inline">{:ok, next_chat_state}</code>: resumes the session with the provided <code class="inline">next_chat_state</code>.</li><li><code class="inline">{:ok, next_chat_state, timeout}</code>: resumes the session with the <code class="inline">next_chat_state</code> and sets a new <code class="inline">timeout</code>.</li></ul><p>The <code class="inline">timeout</code> can be used to schedule actions after a specific period of inactivity.</p>
  </section>
</section>
<section class="detail" id="c:handle_timeout/3">

  <div class="detail-header">
    <a href="#c:handle_timeout/3" class="detail-link" data-no-tooltip="" aria-label="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">handle_timeout(token, chat_id, chat_state)</h1>

        <span class="note">(optional)</span>


        <a href="https://github.com/visciang/telegram/blob/main/lib/chat_bot.ex#L163" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@callback</span> handle_timeout(
  token :: <a href="Telegram.Types.html#t:token/0">Telegram.Types.token</a>(),
  chat_id :: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(),
  chat_state :: <a href="#t:chat_state/0">chat_state</a>()
) ::
  {:ok, next_chat_state :: <a href="#t:chat_state/0">chat_state</a>()}
  | {:ok, next_chat_state :: <a href="#t:chat_state/0">chat_state</a>(), timeout :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">timeout</a>()}
  | {:stop, next_chat_state :: <a href="#t:chat_state/0">chat_state</a>()}</pre>

      </div>

<p>Callback invoked when a session times out.</p><h3 id="c:handle_timeout/3-parameters" class="section-heading">
  <a href="#c:handle_timeout/3-parameters" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Parameters</span>
</h3>
<ul><li><code class="inline">token</code>: the bot's authentication token, used for making API requests.</li><li><code class="inline">chat_id</code>: the ID of the chat where the session timed out.</li><li><code class="inline">chat_state</code>: the current state of the chat session at the time of the timeout.</li></ul><h3 id="c:handle_timeout/3-return-values" class="section-heading">
  <a href="#c:handle_timeout/3-return-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Return Values:</span>
</h3>
<ul><li><code class="inline">{:ok, next_chat_state}</code>: keeps the session alive with an updated <code class="inline">next_chat_state</code>.</li><li><code class="inline">{:ok, next_chat_state, timeout}</code>: updates the <code class="inline">next_chat_state</code> and sets a new <code class="inline">timeout</code>.</li><li><code class="inline">{:stop, next_chat_state}</code>: terminates the session and finalizes the <code class="inline">chat_state</code>.</li></ul><p>This callback is <strong>optional</strong>.
If not implemented, the bot will stops when a timeout occurs.</p>
  </section>
</section>
<section class="detail" id="c:handle_update/3">

  <div class="detail-header">
    <a href="#c:handle_update/3" class="detail-link" data-no-tooltip="" aria-label="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">handle_update(update, token, chat_state)</h1>


        <a href="https://github.com/visciang/telegram/blob/main/lib/chat_bot.ex#L140" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@callback</span> handle_update(
  update :: <a href="Telegram.Types.html#t:update/0">Telegram.Types.update</a>(),
  token :: <a href="Telegram.Types.html#t:token/0">Telegram.Types.token</a>(),
  chat_state :: <a href="#t:chat_state/0">chat_state</a>()
) ::
  {:ok, next_chat_state :: <a href="#t:chat_state/0">chat_state</a>()}
  | {:ok, next_chat_state :: <a href="#t:chat_state/0">chat_state</a>(), timeout :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">timeout</a>()}
  | {:stop, next_chat_state :: <a href="#t:chat_state/0">chat_state</a>()}</pre>

      </div>

<p>Handles incoming Telegram update events and processes them based on the current <code class="inline">chat_state</code>.</p><h3 id="c:handle_update/3-parameters" class="section-heading">
  <a href="#c:handle_update/3-parameters" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Parameters:</span>
</h3>
<ul><li><code class="inline">update</code>: the incoming Telegram <a href="https://core.telegram.org/bots/api#update">update</a> event (e.g., a message, an inline query).</li><li><code class="inline">token</code>: the bot's authentication token, used to make API requests.</li><li><code class="inline">chat_state</code>: the current state of the chat session.</li></ul><h3 id="c:handle_update/3-return-values" class="section-heading">
  <a href="#c:handle_update/3-return-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Return values:</span>
</h3>
<ul><li><code class="inline">{:ok, next_chat_state}</code>: updates the chat session with the new <code class="inline">next_chat_state</code>.</li><li><code class="inline">{:ok, next_chat_state, timeout}</code>: updates the <code class="inline">next_chat_state</code> and sets a new <code class="inline">timeout</code> for the session.</li><li><code class="inline">{:stop, next_chat_state}</code>: terminates the chat session and returns the final <code class="inline">next_chat_state</code>.</li></ul><p>The <code class="inline">timeout</code> option can be used to define how long the bot will wait for the next event before triggering a timeout.</p>
  </section>
</section>
<section class="detail" id="c:init/1">

  <div class="detail-header">
    <a href="#c:init/1" class="detail-link" data-no-tooltip="" aria-label="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">init(chat)</h1>


        <a href="https://github.com/visciang/telegram/blob/main/lib/chat_bot.ex#L100" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@callback</span> init(chat :: <a href="Telegram.ChatBot.Chat.html#t:t/0">Telegram.ChatBot.Chat.t</a>()) ::
  {:ok, initial_state :: <a href="#t:chat_state/0">chat_state</a>()}
  | {:ok, initial_state :: <a href="#t:chat_state/0">chat_state</a>(), timeout :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">timeout</a>()}</pre>

      </div>

<p>Invoked when a chat session is first initialized. Returns the initial <code class="inline">chat_state</code> for the session.</p><h3 id="c:init/1-parameters" class="section-heading">
  <a href="#c:init/1-parameters" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Parameters:</span>
</h3>
<ul><li><code class="inline">chat</code>: the <a href="Telegram.ChatBot.Chat.html#t:t/0"><code class="inline">Telegram.ChatBot.Chat.t/0</code></a> struct returned by <a href="#c:get_chat/2"><code class="inline">get_chat/2</code></a>.</li></ul><h3 id="c:init/1-return-values" class="section-heading">
  <a href="#c:init/1-return-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Return values</span>
</h3>
<ul><li><code class="inline">{:ok, initial_state}</code>: initializes the session with the provided <code class="inline">initial_state</code>.</li><li><code class="inline">{:ok, initial_state, timeout}</code>: initializes the session with the provided <code class="inline">initial_state</code>, and sets a timeout for the session.</li></ul><p>The <code class="inline">timeout</code> can be used to schedule actions after a certain period of inactivity.</p>
  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="lookup/2">

  <div class="detail-header">
    <a href="#lookup/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">lookup(token, chat_id)</h1>


        <a href="https://github.com/visciang/telegram/blob/main/lib/chat_bot.ex#L320" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> lookup(<a href="Telegram.Types.html#t:token/0">Telegram.Types.token</a>(), <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()) ::
  {:error, :not_found} | {:ok, <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">pid</a>()}</pre>

      </div>

<p>Retrieves the process ID (<code class="inline">pid</code>) of a specific chat session.</p><p>This function allows you to look up the active process managing a particular chat session.</p><p>Note: it is the user's responsibility to maintain and manage the mapping between
the custom session identifier (specific to the business logic) and the Telegram <code class="inline">chat_id</code>.</p><h3 id="lookup/2-return-values" class="section-heading">
  <a href="#lookup/2-return-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Return values:</span>
</h3>
<ul><li><code class="inline">{:ok, pid}</code>: successfully found the pid of the chat session.</li><li><code class="inline">{:error, :not_found}</code>: no active session was found for the provided <code class="inline">chat_id</code>.</li></ul>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.37.3) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
